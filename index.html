<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="utf-8" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
    <script src="js\info-panel.js"></script>
    <script src="js\control.js"></script>
    <script src="js\poi.js"></script>
    <script>
      

    </script>

    <title>WebAR-Example</title>
</head>

<body>


    <a-scene>
        <!--vr-mode-ui="enabled: false"-->
        <!--Camera with customized cursor-->
        <a-camera id="mainCamera" gps-camera rotation-reader>
            <a-cursor id="cursor"
                      animation__click="property: scale; from: 0.1 0.1 0.1; to: 1 1 1; easing: easeInCubic; dur: 150; startEvents: click"
                      animation__clickreset="property: scale; to: 1 1 1; dur: 1; startEvents: animationcomplete__click"
                      animation__fusing="property: scale; from: 1 1 1; to: 0.1 0.1 0.1; easing: easeInCubic; dur: 150; startEvents: fusing"></a-cursor>
        </a-camera>

        <a-assets>
            <!--Sky-->
            <img id="sky" src="img\belfast360.jpg" crossorigin="anonymous">

            <img id="cranes" src="img\s&g.png" crossorigin="anonymous" />
            <img id="cavehill" src="img\Cave-Hill.jpg" crossorigin="anonymous" />
            <img id="cityhall" src="img\cityhall.png" crossorigin="anonymous" />

            <!--Test Video-->
            <video id="video" crossorigin="anonymous"></video>

            <!--Models-->
            <!--<a-asset-item id="cityHall" src="https://raw.githubusercontent.com/gcampbell90/gcampbell90.github.io/1cf45bcd1a8ae3da9852b0a08392861f121a2787/models/titanic.gltf" crossorigin="anonymous"></a-asset-item>
            <a-asset-item id="caveHill" src="https://raw.githubusercontent.com/gcampbell90/gcampbell90.github.io/1cf45bcd1a8ae3da9852b0a08392861f121a2787/models/titanic.gltf" crossorigin="anonymous"></a-asset-item>
            <a-asset-item id="cranes" src="https://raw.githubusercontent.com/gcampbell90/gcampbell90.github.io/1cf45bcd1a8ae3da9852b0a08392861f121a2787/models/titanic.gltf" crossorigin="anonymous"></a-asset-item>
            <a-asset-item id="titanicBuilding" src="https://raw.githubusercontent.com/gcampbell90/gcampbell90.github.io/1cf45bcd1a8ae3da9852b0a08392861f121a2787/models/titanic.gltf" crossorigin="anonymous"></a-asset-item>
            <a-asset-item id="belfastCastle" src="https://raw.githubusercontent.com/gcampbell90/gcampbell90.github.io/1cf45bcd1a8ae3da9852b0a08392861f121a2787/models/titanic.gltf" crossorigin="anonymous"></a-asset-item>-->
            <!--Mixins for UI-->
            <a-mixin id="frame"
                     geometry="primitive: plane; width: 0.6; height: 0.8"
                     material="color: black; shader: flat"
                     animation__scale="property: scale; to: 1.2 1.2 1.2; dur: 200; startEvents: mouseenter"
                     animation__scale_reverse="property: scale; to: 1 1 1; dur: 200; startEvents: mouseleave">
            </a-mixin>

            <a-mixin id="poiImage"
                     geometry="primitive: plane; width: 1.5; height: 0.8"
                     material="src: #city; shader: flat; transparent: true"
                     position="1 .4 0.1">
            </a-mixin>
        </a-assets>

        <!--Scene setup-->
        <a-sky src="#sky" rotation="0 -90 0"></a-sky>

        <!--Light-->
        <!--<a-light type="directional" position="0 0 0" rotation="-90 0 0" target="#directionaltarget" intensity="10">
            <a-entity id="directionaltarget" position="0 0 -1"></a-entity>
        </a-light>-->
        <!--Points of Interest Interactables-->
        <a-sphere id="cityhallButton" class="poiInteractable" color="blue" scale="0.2 0.2 0.2" position="-.1 1.5 -5.2"></a-sphere>
        <a-entity geometry="primitive: box; width: 0.1; height: 1; depth: 0.1" color="blue" position="-.1 .8 -5.2"></a-entity>

        <a-sphere id="cranesButton" class="poiInteractable" color="red" scale="0.2 0.2 0.2" position="-5 3 2"></a-sphere>
        <a-entity geometry="primitive: box; width: 0.1; height: 1; depth: 0.1" color="red" position="-5 2.3 2"></a-entity>

        <a-sphere id="cavehillButton" class="poiInteractable" color="green" scale="0.2 0.2 0.2" position="1 3 5"></a-sphere>
        <a-entity geometry="primitive: box; width: 0.1; height: 1; depth: 0.1" color="green" position="1 2.3 5"></a-entity>


        <a-entity info-panel
                  id="info-panel"
                  visible="false"
                  position="0 0 -5"
                  look-at="[camera]"
                  geometry="primitive: plane; width: 4.5; height: 2"
                  material="shader: flat; color: blue">

            <a-entity id="poiTitle"
                      position=".9 .9 0"
                      text="shader: msdf; anchor: left; width: 1.5; font: https://cdn.aframe.io/examples/ui/Viga-Regular.json; color: white;
                      value: POI Title">
            </a-entity>

            <a-entity id="poiDescription"
                      position="-1.5 0.5 0"
                      text="shader: msdf; anchor: left; width: 1.5; font: https://cdn.aframe.io/examples/ui/Viga-Regular.json; color: white;
                    value: Description of POI">
            </a-entity>

            <a-entity id="url"
                      position="-1.9 1 0"
                      geometry="primitive: sphere; width: 0.01; radius: 0.1"
                      material="shader: flat; color: red">
                <a-text value="Play/Pause Video" color="#FFF" align="center" position="0 -.25 0" width="1.3"></a-text>

                <a-entity id="urlText"
                          text="shader: msdf; anchor: right; width: 1.3; font: https://cdn.aframe.io/examples/ui/Viga-Regular.json; color: white;
                    value: Press to Play/Video">
                </a-entity>
            </a-entity>

            <a-entity id="poiCHImage" mixin="poiImage" material="src: #cityhall" visible="false" style="top:10px; left:20px; height:100px;"></a-entity>
            <a-entity id="poiCranesImage" mixin="poiImage" material="src: #cranes" visible="false" style="top:10px; left:20px; height:100px;"></a-entity>
            <a-entity id="poiCaveHillImage" mixin="poiImage" material="src: #cavehill" visible="false" style="top:10px; left:20px; height:100px;"></a-entity>

            <a-entity position="-.75 -.4 .2">
                <a-box id="exploreBtn" width="1.2" height="0.15" depth="0.05" color="green">
                    <a-text value="Click Button Below to Explore Area" color="#FFF" align="center" position="0 .25 0" width="2"></a-text>
                </a-box>
            </a-entity>

            <a-entity id="vidContainer" visible="true" position="1 -0.4 0.5">
                <a-video id="vid" src="#video" width="1.5" height=".75"></a-video>
            </a-entity>
        </a-entity>

        <!--<a-entity id="sceneModel" gltf-model="#titanicBuilding" rotation="0 90 0" scale="0.05 0.05 0.05"></a-entity>-->

        <a-entity id="poiBox">
            <a-box color="red" scale="0.1 0.1 0.1"></a-box>
        </a-entity>

    </a-scene>

</body>
</html>

<script>
    var myPosition = { x: 0, y: 1, z: -3 };
    
    // Create an entity and set its position to the stored variable
    /*        var myEntity = document.createElement("a-entity");*/

    //var myEntity = document.querySelector("#sceneModel");
    //myEntity.setAttribute("position", myPosition);
    var scene = document.querySelector("a-scene");
    //console.log(scene);
    var poiBox = document.querySelector('#poiBox');


    if (navigator.geolocation) {
        console.log("Geolocation is supported")

        navigator.geolocation.getCurrentPosition(
            function (position) {
                // Success: the user has allowed access to their location
                const latitude = position.coords.latitude;
                const longitude = position.coords.longitude;
                // Do something with the latitude and longitude
                //let gps = document.createAttribute('gps-entity-place');
                //var gps= `latitude: ${position.coords.latitude - 0.1}; longitude: ${position.coords.longitude + 0.1}`;
                var gps = `latitude: ${54.580}; longitude: ${-6.025}`;

                let scene = document.querySelector("a-scene");

                //scene.setAttributeNode(gps);


                //poiBox.setAttributeNode(gps);
                //poiBox.setAttribute('gps-entity-place', gps);
                poiBox.setAttribute('gps-entity-place', gps);

                console.log("Location: ", gps);
                var attrib = poiBox.getAttribute('gps-entity-place');
                console.log(attrib);

                //console.log("poiBox: ", poiBox.getAttribute('gps-entity-place'));
            },
            function (error) {
                // Error: the user has denied access to their location
                console.error(error);
            }
        );
    } else {
        console.log(" Geolocation is not supported")
    }




    pois.forEach(function (poi) {
        var poiEntity = document.createElement("a-entity");

        poiEntity.setAttribute("id", poi.name);
        poiEntity.setAttribute("look-at", "#mainCamera");
        poiEntity.setAttribute("position", poi.position);
        poiEntity.setAttribute("text", {
            value: poi.name,
            align: "center",
            width: "6",
            color: "black"
        });
        poiEntity.addEventListener("click", function () {
            alert(poi.description);
        });
        console.log("Creating poi", poi.name);
        scene.appendChild(poiEntity);
    });

</script>