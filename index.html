<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="utf-8" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
    <script src="js\poi.js"></script>
    <script src="js\info-panel.js"></script>

    <title>WebAR-Example</title>

</head>

<body>


    <a-scene>
        <!--Camera with customized cursor-->
        <a-camera id="mainCamera" gps-camera rotation-reader>
            <a-cursor id="cursor"
                      animation__click="property: scale; from: 0.1 0.1 0.1; to: 1 1 1; easing: easeInCubic; dur: 150; startEvents: click"
                      animation__clickreset="property: scale; to: 1 1 1; dur: 1; startEvents: animationcomplete__click"
                      animation__fusing="property: scale; from: 1 1 1; to: 0.1 0.1 0.1; easing: easeInCubic; dur: 150; startEvents: fusing"></a-cursor>
        </a-camera>

        <a-assets>
            <!--Sky-->
            <img id="sky" src="img/belfast360.jpg" crossorigin="anonymous">

            <!--2d Images-->
            <img id="CityHallImg" src="img\cityhall.png" crossorigin="anonymous" />
            <img id="SamsonGoliathImg" src="img\s&g.png" crossorigin="anonymous" />
            <img id="TitanicImg" src="img\titanicBuilding.jpg" crossorigin="anonymous" />
            <img id="CaveHillImg" src="img\Cave-Hill.jpg" crossorigin="anonymous" />
            <img id="StormontImg" src="img\stormontBuilding.jpg" crossorigin="anonymous" />

            <!--Models-->
            <a-asset-item id="cityHall" src='https://raw.githubusercontent.com/gcampbell90/gcampbell90.github.io/8d72dc79b0c709818c6bf2a716bcbf5d8dce1542/models/TitanicBuilding.gltf' crossorigin="anonymous"></a-asset-item>
            <a-asset-item id="caveHill" src='https://raw.githubusercontent.com/gcampbell90/gcampbell90.github.io/8d72dc79b0c709818c6bf2a716bcbf5d8dce1542/models/TitanicBuilding.gltf' crossorigin="anonymous"></a-asset-item>
            <a-asset-item id="cranesModel" src='https://raw.githubusercontent.com/gcampbell90/gcampbell90.github.io/8d72dc79b0c709818c6bf2a716bcbf5d8dce1542/models/Samson%26Goliath.gltf' crossorigin="anonymous"></a-asset-item>
            <a-asset-item id="titanicBuilding" src="https://raw.githubusercontent.com/gcampbell90/gcampbell90.github.io/8d72dc79b0c709818c6bf2a716bcbf5d8dce1542/models/TitanicBuilding.gltf" crossorigin="anonymous"></a-asset-item>
            <a-asset-item id="stormontBuilding" src="https://raw.githubusercontent.com/gcampbell90/gcampbell90.github.io/8d72dc79b0c709818c6bf2a716bcbf5d8dce1542/models/TitanicBuilding.gltf" crossorigin="anonymous"></a-asset-item>

            <!--Test Video-->
            <video id="video" crossorigin="anonymous"></video>

            <!--Mixins for UI-->
            <a-mixin id="frame"
                     geometry="primitive: plane; width: 0.6; height: 0.8"
                     material="color: black; shader: flat"
                     animation__scale="property: scale; to: 1.2 1.2 1.2; dur: 200; startEvents: mouseenter"
                     animation__scale_reverse="property: scale; to: 1 1 1; dur: 200; startEvents: mouseleave">
            </a-mixin>

            <a-mixin id="poiImage"
                     geometry="primitive: plane; width: 1.5; height: 0.8"
                     material="src: #CityHallImg; shader: flat; transparent: false"
                     position="1 .4 0.1">
            </a-mixin>

        </a-assets>

        <!--Scene setup-->
        <!--<a-sky src="#sky" rotation="0 -90 0"></a-sky>-->

        <!--Light-->
        <a-light type="directional" position="0 0 0" target="#directionaltarget" intensity="5">
            <a-entity id="directionaltarget" position="-10 0 -5"></a-entity>
        </a-light>
        <a-light type="ambient" colour="#FFF">
        </a-light>

        <!--<a-entity id="sphere" geometry="primitive: box; width: 0.5; height: 0.5; depth: 0.5" visible="true" position="0 2 -5"
                  animation__mouseenter="property:scale; to:1.5 1.5 1.5; easing:linear; dur:500; startEvents: mouseenter"
                  animation__mouseleave="property:scale; to:1 1 1; easing:linear; dur:500; startEvents: mouseleave" );></a-entity>-->


        <a-entity info-panel
                  id="info-panel"
                  visible="false"
                  position="0 0 -3"
                  look-at="[camera]"
                  geometry="primitive: plane; width: 5; height: 2"
                  material="shader: flat; color: blue">

            <a-entity id="poiTitle"
                      position=".9 .9 0"
                      text="shader: msdf; anchor: left; width: 1.5; font: https://cdn.aframe.io/examples/ui/Viga-Regular.json; color: white;
                      value: POI Title">
            </a-entity>

            <a-entity id="poiDescription"
                      position="-1.5 0.5 0"
                      text="shader: msdf; anchor: left; width: 1.5; font: https://cdn.aframe.io/examples/ui/Viga-Regular.json; color: white;
                    value: Description of POI">
            </a-entity>

            <a-entity id="url"
                      position="-1.9 1 0"
                      geometry="primitive: sphere; width: 0.01; radius: 0.1"
                      material="shader: flat; color: red">
                <a-text value="Play/Pause Video" color="#FFF" align="center" position="0 -.25 0" width="1.5"></a-text>
            </a-entity>

            <a-entity id="poiCityHallImg" mixin="poiImage" material="src: #CityHallImg" visible="false" style="top:10px; left:20px; height:100px;"></a-entity>
            <a-entity id="poiSamsonGoliathImg" mixin="poiImage" material="src: #SamsonGoliathImg" visible="false" style="top:10px; left:20px; height:100px;"></a-entity>
            <a-entity id="poiTitanicImg" mixin="poiImage" material="src: #TitanicImg" visible="false" style="top:10px; left:20px; height:100px;"></a-entity>
            <a-entity id="poiCaveHillImg" mixin="poiImage" material="src: #CaveHillImg" visible="false" style="top:10px; left:20px; height:100px;"></a-entity>
            <a-entity id="poiBelfastCastleImg" mixin="poiImage" material="src: #CaveHillImg" visible="false" style="top:10px; left:20px; height:100px;"></a-entity>


            <a-entity position="-.75 -.4 .2">
                <a-box id="exploreBtn" width="1.2" height="0.15" depth="0.05" color="green">
                    <a-text value="Click Button Below to Explore Area" color="#FFF" align="center" position="0 .25 0" width="2"></a-text>
                </a-box>
            </a-entity>

            <!--<a-entity id="vidContainer" visible="true" position="1 -0.4 0.5">
                <a-video id="vid" src="#video" width="1.5" height=".75"></a-video>
            </a-entity>-->
        </a-entity>

    </a-scene>
</body>
</html>

<script>
    pois.forEach(function (poi) {



        //TextBoxS
        var poiEntity = document.createElement("a-entity");

        poiEntity.setAttribute("id", poi.name);
        poiEntity.setAttribute("look-at", "#mainCamera");
        poiEntity.setAttribute("position",
            {
                x: 0,
                y: 3.5,
                z: 1,
            }
        );

        poiEntity.setAttribute("geometry", {
            primitive: "plane",
            height: "1",
            width: "3.75"
        });

        poiEntity.setAttribute("material", {
            shader: "flat",
            color: "blue",
            side: "double"
        });

        poiEntity.setAttribute("text", {
            value: poi.name,
            align: "center",
            width: "10",
            color: "black"
        });


        //POI model
        var model = document.createElement("a-entity");
        var modelPosition = '0 -1 0';

        model.setAttribute("id", poi.id);
        model.setAttribute("name", poi.name);
        model.setAttribute("gltf-model", poi.model);
        model.setAttribute("scale", poi.scale);
        model.setAttribute("position", modelPosition);
        model.setAttribute("rotation", poi.rotation);

        //interactable sphere
        var interactablesphere = document.createElement("a-entity");
        interactablesphere.setAttribute("id", poi.id);
        interactablesphere.setAttribute("geometry", {
            primitive: 'sphere',
            width: 3,
            radius: 3,
        });
        interactablesphere.setAttribute("material", {
            opacity: 0.0,
            transparent: true
        });
        interactablesphere.setAttribute("class", 'poiInteractable');
        interactablesphere.setAttribute("position", poi.position);
        interactablesphere.setAttribute('animation__mouseenter', "property:scale; to:1.5 1.5 1.5; easing:linear; dur:500; startEvents: mouseenter ");
        interactablesphere.setAttribute('animation__mouseleave', "property:scale; to:1 1 1; easing:linear; dur:500; startEvents: mouseleave ");

        var scene = document.querySelector("a-scene");

        //model.addEventListener('click', function () {
        //    console.log(poi.id + " selected");
        //});
        //model.setAttribute('animation__mouseenter', "property:scale; to:1.5 1.5 1.5; easing:linear; dur:500; startEvents: mouseenter ");
        //model.setAttribute('animation__mouseleave', "property:scale; to:1 1 1; easing:linear; dur:500; startEvents: mouseleave ");

        //model.appendChild(interactablesphere);
        //scene.appendChild(model);

        model.appendChild(poiEntity);
        interactablesphere.appendChild(model);
        scene.appendChild(interactablesphere);


    });

    //// Create an entity and set its position to the stored variable
    ///*        var myEntity = document.createElement("a-entity");*/
    ////var myEntity = document.querySelector("#sceneModel");
    //var scene = document.querySelector("a-scene");
    ////console.log(scene);

    //if (navigator.geolocation) {
    //    console.log("Geolocation is supported")

    //    navigator.geolocation.getCurrentPosition(
    //        function (position) {
    //            // Success: the user has allowed access to their location
    //            //const latitude = position.coords.latitude;
    //            //const longitude = position.coords.longitude;

    //            // Do something with the latitude and longitude
    //            //let gps = document.createAttribute('gps-entity-place');
    //            ////gps.value = `latitude: ${position.coords.latitude - 0.1}; longitude: ${position.coords.longitude + 0.1}`;
    //            //gps.value = `latitude: ${54.59883806903877}; longitude: ${-5.9332469816665485}`;

    //            //let scene = document.querySelector("a-scene");

    //            //scene.setAttributeNode(gps);

    //            //console.log("Location: ", gps.value);
    //            //var attrib = poiBox.getAttribute('gps-entity-place');
    //            //console.log(attrib);

    //            //console.log("poiBox: ", poiBox.getAttribute('gps-entity-place'));
    //        },
    //        function (error) {
    //            // Error: the user has denied access to their location
    //            console.error(error);
    //        }
    //    );
    //} else {
    //    console.log(" Geolocation is not supported")
    //}

</script>